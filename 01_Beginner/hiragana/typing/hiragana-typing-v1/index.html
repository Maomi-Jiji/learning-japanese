<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiragana Typing Practice - Smart Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #ff69b4;
            --soft-pink: #fff0f5;
            --border-pink: #ffb6c1;
            --accent-pink: #ff1493;
            --text-color: #5d4037;
            --target-mark: #ff1493;
        }

        body { 
            font-family: "UD Digital Kyokasho N-R", "UD „Éá„Ç∏„Çø„É´ ÊïôÁßëÊõ∏‰Ωì N-R", "BIZ UDPGothic", "Zen Maru Gothic", sans-serif; 
            background-color: var(--soft-pink); 
            color: var(--text-color); 
            margin: 0; 
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .app-card {
            background: white;
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 5px;
            border-radius: 15px;
            padding: 8px;
            border: 2px solid var(--border-pink);
            box-sizing: border-box;
            min-height: 0;
        }

        .app-title {
            font-size: 20px;
            text-align: center;
            color: var(--text-color);
            margin: 5px 0 10px 0;
            letter-spacing: 2px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .top-chart-section {
            flex: 1; 
            display: flex;
            flex-direction: column;
            background: #fffafa;
            border-radius: 12px;
            padding: 5px;
            border: 1px solid var(--border-pink);
            min-height: 0;
        }

        .tab-menu { display: flex; justify-content: center; gap: 8px; margin-bottom: 5px; flex-wrap: wrap; }
        .tab-menu button {
            font-family: inherit; padding: 4px 12px; font-size: 13px; cursor: pointer;
            border-radius: 10px; border: 2px solid var(--border-pink); background: white; color: var(--primary-pink); font-weight: bold;
        }
        .tab-menu button.active-btn { background: var(--primary-pink); color: white; }
        
        .tab-menu button#btn-challenge { border-color: #5d4037; color: #5d4037; }
        .tab-menu button#btn-challenge.challenge-on { background: #5d4037; color: white; }

        .chart-display-area { 
            flex: 1; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            scroll-behavior: smooth;
        }
        
        table { border-collapse: separate; border-spacing: 2px; background: white; border-radius: 8px; }
        td { 
            border: 1px solid #ffdae0; width: 42px; height: 42px; text-align: center; border-radius: 6px; 
            background: #fff; position: relative;
        }
        
        .challenge-mode-active td:not(.vowel-label):not(.empty-col) .kana,
        .challenge-mode-active td:not(.vowel-label):not(.empty-col) .romaji {
            visibility: hidden;
        }
        .challenge-mode-active td:not(.vowel-label):not(.empty-col)::after {
            content: "?"; color: #eee; font-size: 14px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        .show-cell .kana, .show-cell .romaji { visibility: visible !important; }
        .show-cell::after { display: none !important; }

        .target-cell { border: 3px solid var(--target-mark) !important; background-color: #fff0f5 !important; z-index: 5; }
        .vowel-label { background: var(--soft-pink); color: var(--accent-pink); font-size: 11px; font-weight: bold; width: 30px; border: none; }
        .kana { font-size: 18px; font-weight: 700; color: #333; display: block; line-height: 1; }
        .romaji { font-size: 9px; color: var(--primary-pink); display: block; opacity: 0.8; }

        .bottom-quiz-section {
            height: 180px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #fff;
            border-top: 2px solid var(--soft-pink);
            padding: 10px;
            gap: 5px;
            position: relative;
        }

        .score-box { position: absolute; top: 10px; right: 20px; font-size: 14px; font-weight: bold; color: var(--accent-pink); }
        #question { font-size: 70px; color: var(--primary-pink); margin: 0; font-weight: bold; line-height: 1; }
        .input-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        #answer-input { font-family: inherit; font-size: 24px; padding: 8px; width: 160px; text-align: center; border: 2px solid var(--border-pink); border-radius: 20px; outline: none; }
        .action-btn { padding: 8px 30px; font-size: 16px; font-weight: bold; background: var(--primary-pink); color: white; border: none; border-radius: 15px; cursor: pointer; transition: transform 0.1s; }
        #next-btn { display: none; background: #4caf50; }
        #feedback { font-size: 16px; font-weight: bold; height: 20px; }
    </style>
</head>
<body>

<div class="app-card">
    <h1 class="app-title">Hiragana Typing</h1>

    <div class="top-chart-section">
        <div class="tab-menu">
            <button id="btn-basic" onclick="setMode('basic')">Basic</button>
            <button id="btn-contracted" onclick="setMode('contracted')">Contracted</button>
            <button id="btn-foreign" onclick="setMode('foreign')">Foreign</button>
            <button id="btn-mix" onclick="setMode('mix')">MIX</button>
            <button id="btn-challenge" onclick="toggleChallenge()">Challenge ‚ú® OFF</button>
        </div>
        <div id="display-area" class="chart-display-area">
            <div id="chart-container"></div>
        </div>
    </div>

    <div class="bottom-quiz-section">
        <div class="score-box">Correct: <span id="score-count">0</span></div>
        <div id="question">?</div>
        <div class="input-wrapper">
            <input type="text" id="answer-input" placeholder="Type..." autocomplete="off">
            <div id="feedback"></div>
            <div class="btn-group">
                <button id="check-btn" class="action-btn" onclick="check()">OK (Enter)</button>
                <button id="next-btn" class="action-btn" onclick="nextQuestion()">Next (Enter)</button>
            </div>
        </div>
    </div>
</div>

<script>
    const charts = {
        basic: [[0,0,"„ÅÇ","a"],[0,1,"„ÅÑ","i"],[0,2,"„ÅÜ","u"],[0,3,"„Åà","e"],[0,4,"„Åä","o"],[1,0,"„Åã","ka"],[1,1,"„Åç","ki"],[1,2,"„Åè","ku"],[1,3,"„Åë","ke"],[1,4,"„Åì","ko"],[2,0,"„Åï","sa"],[2,1,"„Åó","shi"],[2,2,"„Åô","su"],[2,3,"„Åõ","se"],[2,4,"„Åù","so"],[3,0,"„Åü","ta"],[3,1,"„Å°","chi"],[3,2,"„Å§","tsu"],[3,3,"„Å¶","te"],[3,4,"„Å®","to"],[4,0,"„Å™","na"],[4,1,"„Å´","ni"],[4,2,"„Å¨","nu"],[4,3,"„Å≠","ne"],[4,4,"„ÅÆ","no"],[5,0,"„ÅØ","ha"],[5,1,"„Å≤","hi"],[5,2,"„Åµ","fu"],[5,3,"„Å∏","he"],[5,4,"„Åª","ho"],[6,0,"„Åæ","ma"],[6,1,"„Åø","mi"],[6,2,"„ÇÄ","mu"],[6,3,"„ÇÅ","me"],[6,4,"„ÇÇ","mo"],[7,0,"„ÇÑ","ya"],[7,2,"„ÇÜ","yu"],[7,4,"„Çà","yo"],[8,0,"„Çâ","ra"],[8,1,"„Çä","ri"],[8,2,"„Çã","ru"],[8,3,"„Çå","re"],[8,4,"„Çç","ro"],[9,0,"„Çè","wa"],[9,2,"„Çí","wo"],[9,4,"„Çì","nn"],[11,0,"„Åå","ga"],[11,1,"„Åé","gi"],[11,2,"„Åê","gu"],[11,3,"„Åí","ge"],[11,4,"„Åî","go"],[12,0,"„Åñ","za"],[12,1,"„Åò","ji"],[12,2,"„Åö","zu"],[12,3,"„Åú","ze"],[12,4,"„Åû","zo"],[13,0,"„Å†","da"],[13,1,"„Å¢","ji"],[13,2,"„Å•","zu"],[13,3,"„Åß","de"],[13,4,"„Å©","do"],[14,0,"„Å∞","ba"],[14,1,"„Å≥","bi"],[14,2,"„Å∂","bu"],[14,3,"„Åπ","be"],[14,4,"„Åº","bo"],[15,0,"„Å±","pa"],[15,1,"„Å¥","pi"],[15,2,"„Å∑","pu"],[15,3,"„Å∫","pe"],[15,4,"„ÅΩ","po"]],
        contracted: [[0,0,"„Åç„ÇÉ","kya"],[0,2,"„Åç„ÇÖ","kyu"],[0,4,"„Åç„Çá","kyo"],[1,0,"„Åó„ÇÉ","sha"],[1,2,"„Åó„ÇÖ","shu"],[1,4,"„Åó„Çá","sho"],[2,0,"„Å°„ÇÉ","cha"],[2,2,"„Å°„ÇÖ","chu"],[2,4,"„Å°„Çá","cho"],[3,0,"„Å´„ÇÉ","nya"],[3,2,"„Å´„ÇÖ","nyu"],[3,4,"„Å´„Çá","nyo"],[4,0,"„Å≤„ÇÉ","hya"],[4,2,"„Å≤„ÇÖ","hyu"],[4,4,"„Å≤„Çá","hyo"],[5,0,"„Åø„ÇÉ","mya"],[5,2,"„Åø„ÇÖ","myu"],[5,4,"„Åø„Çá","myo"],[6,0,"„Çä„ÇÉ","rya"],[6,2,"„Çä„ÇÖ","ryu"],[6,4,"„Çä„Çá","ryo"],[8,0,"„Åé„ÇÉ","gya"],[8,2,"„Åé„ÇÖ","gyu"],[8,4,"„Åé„Çá","gyo"],[9,0,"„Åò„ÇÉ","ja"],[9,2,"„Åò„ÇÖ","ju"],[9,4,"„Åò„Çá","jo"],[10,0,"„Å≥„ÇÉ","bya"],[10,2,"„Å≥„ÇÖ","byu"],[10,4,"„Å≥„Çá","byo"],[11,0,"„Å¥„ÇÉ","pya"],[11,2,"„Å¥„ÇÖ","pyu"],[11,4,"„Å¥„Çá","pyo"]],
        foreign: [[0,0,"„Åµ„ÅÅ","fa"],[0,1,"„Åµ„ÅÉ","fi"],[0,3,"„Åµ„Åá","fe"],[0,4,"„Åµ„Åâ","fo"],[1,1,"„Å¶„ÅÉ","thi"],[2,3,"„Å°„Åá","che"],[3,1,"„Åß„ÅÉ","dhi"],[3,2,"„Åß„ÇÖ","dhu"],[5,3,"„Åò„Åá","je"],[6,3,"„Åó„Åá","she"],[8,0,"„Çî„ÅÅ","va"],[8,1,"„Çî„ÅÉ","vi"],[8,2,"„Çî","vu"],[8,3,"„Çî„Åá","ve"],[8,4,"„Çî„Åâ","vo"],[9,1,"„ÅÜ„ÅÉ","wi"],[9,3,"„ÅÜ„Åá","we"],[9,4,"„ÅÜ„Åâ","who"]]
    };

    let currentCategory = 'basic'; 
    let currentQ = null; 
    let score = 0;
    let isChallengeMode = false;

    function renderSingleTable(mode, labelText) {
        const list = charts[mode];
        const maxCol = Math.max(...list.map(d => d[0]));
        // ÊãóÈü≥„É¢„Éº„Éâ„ÅÆÊôÇ„Å†„Åë a/u/o „É©„Éô„É´„Å´„Åô„Çã
        const labels = (mode === 'contracted') ? ["a","i","u","e","o"] : ["a","i","u","e","o"];
        
        let html = `<div><small style="color:var(--primary-pink); font-weight:bold;">${labelText}</small><table>`;
        for (let r = 0; r < 5; r++) {
            html += `<tr><td class="vowel-label">${labels[r]}</td>`;
            for (let c = 0; c <= maxCol; c++) {
                const item = list.find(d => d[0] === c && d[1] === r);
                if (item) { html += `<td id="cell-${mode}-${c}-${r}"><span class="kana">${item[2]}</span><span class="romaji">${item[3]}</span></td>`; }
                else { html += '<td class="empty-col" style="border:none;background:none;"></td>'; }
            }
            html += '</tr>';
        }
        return html + '</table></div>';
    }

    function setMode(category) {
        currentCategory = category;
        const container = document.getElementById('chart-container');
        document.querySelectorAll('.tab-menu button').forEach(b => {
            if(b.id !== 'btn-challenge') b.classList.remove('active-btn');
        });
        document.getElementById('btn-' + category).classList.add('active-btn');
        
        if (category === 'mix') {
            container.innerHTML = renderSingleTable('basic', 'Basic') + renderSingleTable('contracted', 'Contracted') + renderSingleTable('foreign', 'Foreign');
        } else {
            container.innerHTML = renderSingleTable(category, category.toUpperCase());
        }
        nextQuestion();
    }

    function toggleChallenge() {
        isChallengeMode = !isChallengeMode;
        const btn = document.getElementById('btn-challenge');
        const displayArea = document.getElementById('display-area');
        
        if (isChallengeMode) {
            btn.classList.add('challenge-on');
            btn.innerText = "Challenge ‚ú® ON";
            displayArea.classList.add('challenge-mode-active');
        } else {
            btn.classList.remove('challenge-on');
            btn.innerText = "Challenge ‚ú® OFF";
            displayArea.classList.remove('challenge-mode-active');
        }
        document.querySelectorAll('td').forEach(td => td.classList.remove('target-cell', 'show-cell'));
    }

    function showTargetCell(isForceShow) {
        document.querySelectorAll('td').forEach(td => td.classList.remove('target-cell', 'show-cell'));
        const cellId = `cell-${currentQ.sourceMode}-${currentQ.data[0]}-${currentQ.data[1]}`;
        const targetCell = document.getElementById(cellId);
        if (targetCell) {
            targetCell.classList.add('target-cell');
            if (isForceShow) targetCell.classList.add('show-cell');
            targetCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    function nextQuestion() {
        let sourceMode = (currentCategory === 'mix') ? ['basic', 'contracted', 'foreign'][Math.floor(Math.random() * 3)] : currentCategory;
        const source = charts[sourceMode];
        currentQ = { data: source[Math.floor(Math.random() * source.length)], sourceMode: sourceMode };
        document.getElementById('question').innerText = currentQ.data[2];
        const input = document.getElementById('answer-input');
        input.value = ''; input.disabled = false; input.focus();
        document.getElementById('feedback').innerText = '';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('check-btn').style.display = 'inline-block';
        document.querySelectorAll('td').forEach(td => td.classList.remove('target-cell', 'show-cell'));
    }

    function check() {
        const val = document.getElementById('answer-input').value.toLowerCase().trim();
        if(!val) return;

        const kana = currentQ.data[2];
        const ans = currentQ.data[3];

        // ÊúÄÊñ∞„ÅÆÂº∑Âäõ„Å™Âà§ÂÆö„É≠„Ç∏„ÉÉ„ÇØ
        let isCorrect = (val === ans);
        if (!isCorrect) {
            const alt = {
                '„Åó': ['si'], '„Åó„ÇÉ': ['sya'], '„Åó„ÇÖ': ['syu'], '„Åó„Çá': ['syo'],
                '„Å°': ['ti'], '„Å°„ÇÉ': ['tya', 'cya'], '„Å°„ÇÖ': ['tyu', 'cyu'], '„Å°„Çá': ['tyo', 'cyo'],
                '„Å§': ['tu'], '„Åµ': ['hu'],
                '„Åò': ['zi'], '„Åò„ÇÉ': ['zya', 'ja'], '„Åò„ÇÖ': ['zyu', 'ju'], '„Åò„Çá': ['zyo', 'jo'],
                '„Çí': ['o'], '„Çì': ['n'], '„Å¢': ['ji', 'di'], '„Å•': ['zu', 'du'],
                '„Çî„ÅÅ': ['va'], '„Çî„ÅÉ': ['vi'], '„Çî': ['vu'], '„Çî„Åá': ['ve'], '„Çî„Åâ': ['vo']
            };
            if (alt[kana] && alt[kana].includes(val)) isCorrect = true;
        }

        if (isCorrect) {
            document.getElementById('feedback').innerText = 'Correct! ‚ú®';
            document.getElementById('feedback').style.color = 'var(--accent-pink)';
            score++; document.getElementById('score-count').innerText = score;
            document.getElementById('answer-input').disabled = true;
            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            showTargetCell(true);
        } else {
            document.getElementById('feedback').innerText = 'Check the chartüí°';
            document.getElementById('feedback').style.color = '#ff6347';
            showTargetCell(true); 
        }
    }

    document.getElementById('answer-input').onkeydown = function(e) {
        if (e.key === 'Enter') {
            if (document.getElementById('next-btn').style.display === 'inline-block') nextQuestion();
            else check();
        }
    };
    setMode('basic');
</script>
</body>
</html>
